<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>3D Tetris</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/full-width-pics.css" rel="stylesheet">
    <lint href="css/thumbnail-gallery.css" rel="stylesheet">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>

        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">Tetris 3D</a>
                </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Description <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                              <li>
                                <a href="#overview">Overview</a>
                            </li>
                            <li>
                               <a href="#motivation">Motivation & Goals</a>
                            </li>
                            <li>
                               <a href="#rule">Game Rule</a>
                            </li>
                            <li>
                               <a href="#tools">Tools</a>
                            </li>
                            <li>
                               <a href="#unique">Development Process & Uniqueness</a>
                            </li>
                            <li>
                               <a href="#technicalDetails">Technical Details</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#thumbNails">Thumbnails</a>
                    </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container -->
        </nav>

        <!-- Full Width Image Header with Logo -->
        <!-- Image backgrounds are set within the full-width-pics.css file. -->
        <header class="image-bg-fluid-height">
            <img class="img-responsive img-center" src="" alt="">
        </header>

        <!-- Content Section -->
        <section>
            <div class="container" id="overview">
                <div class="row">
                    <div class="col-lg-12">
                        <h1 class="section-heading">Overview</h1>
                        <p class="lead section-lead">3D Tetris in a nutshell</p>
                        <p class="section-paragraph">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquid, suscipit, rerum quos facilis repellat architecto commodi officia atque nemo facere eum non illo voluptatem quae delectus odit vel itaque amet.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Fixed Height Image Aside -->
        <!-- Image backgrounds are set within the full-width-pics.css file. -->
        <aside class="image-bg-fixed-height"></aside>

        <!-- Content Section -->
        <section>
            <div class="container" id="motivation">
                <div class="row">
                    <div class="col-lg-12">
                        <h1 class="section-heading">Motivation and goals</h1>
                        <p class="lead section-lead">Why 3D Tetris</p>
                        <p class="section-paragraph">Traditional 2D Tetris Game is an HCI-based application, with only two horizontal movement options (‘left’ and ‘right’) and four 90-degree rotation options. We created a 3D interface-based Tetris Game embedded on a marker in the real world. The main challenges for 3D Tetris Game design is that: 3D tetris is of 4 types of horizontal movements and up to 24 90-degree rotation gestures. We creatively imported Augmented Reality techniques here to increase interaction for users to ‘physically’ manipulate tetris gestures and positions. In our tetris game, the user could actually use a single board with special patterns to complete all these otherwise intricate controls if implemented using screen buttons. Our inspiration comes from the well-designed augmented reality project--<a href="https://www.dropbox.com/s/3f83y9dbpallwpi/isar2001-VOMAR-4.mov?dl=0">ARToolkit furniture interaction</a>.With the help of Vuforia SDK, we are able to finish feature detection and feature tracking and obtain transition modelview matrix between cameras and markers in the very first place.</p>

                        <p class="section-paragraph">Here is the list of our goals</p>
                        <p class="section-paragraph"><ul class="list-group">
                            <li class="list-group-item">1.Render multiple types of tetris.</li>
                            <li class="list-group-item">2.Sloping angle (between bottom and board) detection.</li>
                            <li class="list-group-item">3.Rotate tetris and move tetris horizontally using marker board (especially, achieve continuous rotation when manipulated by board to increase immersion of user experience
                                ).</li>
                                <li class="list-group-item">4.Collision detection (when to land tetris).
                                </li>
                                <li class="list-group-item">5.Border detection (whatever movements should not place tetris beyond border).</li>
                            </ul></p>
                        </div>
                    </div>
                    <!-- /.row -->
                </div>
                <!-- /.container -->
            </section>
            
                            <hr/>
                <section>
                    <div class="container" id="rule">
                        <div class="row">
                            <div class="col-lg-12">
                                <h1 class="section-heading">Game Rule</h1>
                                <p class="lead section-lead">How to play</p>
                                <p class="section-paragraph">
                                   <ul class="list-group">
                                    <li class="list-group-item">1.Relase tetris from the marker board.</li>
                                    <li class="list-group-item">2.Manipulate tetris movement (360-degree rotation and horizontal translation) using the same marker board. </li>
                                    <li class="list-group-item">3.Alternatively manipulate tetris movement (only horizontal translation) using screen buttons.</li>
                                    <li class="list-group-item">4.Eliminate a layer when it is full. Get 100 points for each elimination.
                                    </li>
                                </ul>       
                            </p>
                        </div>
                    </div>
                </div>
            </section>
            
            <hr/>
            <section>
                <div class="container" id="tools">
                    <div class="row">
                        <div class="col-lg-12">
                            <h1 class="section-heading">Tools</h1>
                            <p class="lead section-lead">What do we use</p>
                            <p class="section-paragraph">
                                <p>
                                    For our tetris game, we used Qualcomm's AR software development kit Vuforia SDK and and OpenGL ES 2.0 on Android 5.0.1 mobile devices.
                                    Vuforia SDK provided toolkits of tracking a specific image, known as the image target, as well as information about the camera's gestures and positions represented as a modelview matrix. This could then be used to place virtual objects onto the image target in terms of the image target coordinate. We used OpenGL ES to render the graphics for different types of tetris. (We didn’t use Unity, though it is widely known to take care of everything. But implementing by ourselves is fun!)

                                </p>
                            </p>
                            </div>
                        </div>
                    </div>
                </section>
<hr/>
            <section>
                <div class="container" id="unique">
                    <div class="row">
                        <div class="col-lg-12">
                            <h1 class="section-heading">Development Process and Uniqueness</h1>
                            <p class="lead section-lead">How do we develop and How do we solve problems creatively</p>
                            <p class="section-paragraph">
                                <p>
                                    We divided our work into three aspects--graphics rendering, tetris logic and control system. We worked on these three aspects simultaneously. 
                                    <p class="section-paragraph"><ul class="list-group">
                    
                                    <li class="list-group-item">Yi works on rendering multiple types of tetris, including creating a well-organized object structure for future complicate manipulation. 
                                    </li>
                                    <li class="list-group-item">Yuesong works on implementing tetris game logic, including collision detection and layer elimination.
                                    </li>
                                    <li class="list-group-item">
                                    Binhan works on implementing the control system, including using marker boards to drop, rotate and translate objects(start with teapot).
                                    </li>
                                    </ul></p>
                                </p>
                                <p>
                                    After we finished all the above aspects, we do the integration together. The most challenging part of integration comes from how to adapt teapot manipulation system to tetris, which consists of multiple objects(cubes). 
                                    We come up with several strategies, but the only one working out is that we need to set a center for each tetris and record the offset of the center of each cube(consisting tetris) in terms of the
                                    pre-set center. When doing rendering, we first find the center position of tetris and then rotate the different cube around the center by the offset radius. In OpenGL, the order should be: <b>translate to offset position -> rotate around origin using updated rotation matrix -> translate the origin to the 
                                    updated center position.</b>
                                </p>
                                
                                <p>
                                    Another issue with tetris manipulation is that, different from teapot, tetris could only rotate to 90-degree position to fit into regular grids.
                                    We managed to find the closest 90-degree pose for each non-grid rotation by calculating the angles between rotated axis and original coordinate axis. But we do not
                                    want to dump continous rotation completely, as it could significantly increase the immersion of user experience. So, we end up with adopting two types of rotation matrix under 
                                    three circumstances: <b>a) when the board is manipulating tetris, use continuous rotation; b) when the board disappears, use 90-degree grid rotation; c) when the tetris land on piles,
                                    use 90-degree grid rotaion.</b>
                                </p>
                                
                                <p>
                                    As for the horizontal movement control, we did go through a hard time. At first, we used a method similar with HW3 -- distance detection.
                                    That is, when the board is close enough to tetris, the tetris would move with the board. But the algorithm is not robust enough, since the distance
                                    would vary in a quite large range even if the tetris "seems" to be close enough. The optimized solution we currently adopted is to use the movement of
                                    the marker board to guide movement of tetris(detailed in the section below). We also add an alternative set of screen buttons to help with manipulation. 
                                </p>
                                
                                <p> 
                                    We also dealt with many other issues, such as sloping angle detection, border detection, which are stated in details in latter sections.
                                </p>
                                
                            </p>
                            </div>
                        </div>
                    </div>
                </section>

            <hr/>
            <section>
                <div class="container" id="technicalDetails ">
                    <div class="row">
                        <div class="col-lg-12">
                            <h1 class="section-heading">Technical Details</h1>
                            <p class="section-paragraph">
                                 <div class="row">

                            <div class="col-lg-12">
                                <h1 class="page-header">1. Project Structure & OOP Design</h1>
                            </div>

                            <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                                <a class="thumbnail" href="#">
                                    <img class="img-responsive" src="image/FileStructure.png" alt="">
                                </a>
                                <h4>FileSturecute</h4>
                            </div>
                            <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                                <a class="thumbnail" href="#">
                                    <img class="img-responsive" src="image/ImageTargetRenderer.png" alt="">
                                </a>
                                <h4>Main Logic Class</h4>
                            </div>
                             <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                                <a class="thumbnail" href="#">
                                    <img class="img-responsive" src="image/Object3D.png" alt="">
                                </a>
                                <h4>Base Object Class</h4>
                            </div>
                           
                        </div>
                            </p>
                            
                            <div class="col-lg-12">
                                <h1 class="page-header">2. Details about graphics and game control</h1>
                            </div>
                            
                            <p class="section-paragraph">

                                <h4> 1) Coordinate System Orchestration </h5>
                                    <p>
                                        Vuforia SDK could provide us the modelview transition matrix between markers and 
                                        cameras(using image tracking techniques). But we need the transition modelview matrix
                                        between the marker board and the bottom. To do that, we simply multiply the inverse matrix of 
                                        bottomModelViewMatrix with boardModelViewMatrix to obtain boardToBottomModelViewMatrix.
                                        </p>
                                        
                                        <p>
                                            We also need to frequently update selfRotationMatrix in terms of both coordinate systems.
                                            When the board appears, we simply multiply the original onBoardSelfRotationMatrix with bottomToBoardModelViewMatrix.
                                            to update current onBoardSelfRotationMatrix. When the board disappears, we simply multiply the original onBottomSelfRotationMatrix with boardToBottomModelViewMatrix
                                            to update current onBottomSelfRotatioMatrix.
                                        </p>
                                </p>
                            
                            <p class="section-paragraph">
                                <h4> 2) Sloping Angle Detection </h5>
                                    <ul class="list-group">
                                        <li class="list-group-item">1.Extract camera rotation matrix from modelview transition matrix(both board(‘chips’) and bottom(‘stones’))</li>
                                        <li class="list-group-item">2.Calculate quanterion of camera rotation matrix and derive euler angles</li>
                                        <li class="list-group-item">3.Calculate the angle between the board and the bottom using two sets of euler angles cos=coscos'+coscos'+coscos')</li>
                                        <li class="list-group-item">4.When the angle is greater than 90 degree, release the object from the board
                                        </li>
                                    </ul>                                          
                                </p>


                                <p class="section-paragraph">
                                    <h4> 3) Manipulate tetris movement using board</h5>
                                    <p></p>
                                    <br/>
                                        <h5><b>Rotation</b></h5>
                                        <p> Scenarios:</p> 
                                        <p>a) When the board appears, the tetris would rotate with the board synchronously.</p>                             
                                        <p>b) When the board disappears, the tetris would fit into the closest 90-degree grid position.</p>
                                        <p>c) When the tetris lands on piles, it need to rotate into a 90-degree pose to fit into grid settings.</p>                    
                                        
                                        <p>Implementation: when the board appears, render tetris within board coordinate(only rotate with board), but update the tetris 90-degree self-rotation matrix under bottom coordinates according to the current boardToBottomModelViewMatrix.  This could achieve continuous rotation on board and grid rotation when the board moves out of screen. Great visual effects! </p>
                                        
                                        <h5><b>Move front/back/left/right</b>   </h5>  
                                        <p>Implementation: when the board appears, the tetris would move synchronously with the board, BUT ONLY move one grid afar. The movement of board must be non-trivial enough(about length of one side of the cube) to guide the grid movement of tetris. And we set 60 frames as detection interval.</p>
                                </p>


                                    <p class="section-paragraph">
                                        <h4> 4) Collision Detection</h4>
                                        We set a maximum height for the piles accumulated on the bottom for each (Xgrid,Ygrid) coordinate. The tetris would fall for length of one side of the cube every 45 frames. When the height of tetris lowers down to the maximum height in terms of the  (Xgrid,Ygrid) coordinate it is currently at, it would be merged into the piles. And the next tetris would be generated on the board.


                                    </p>

                                    <p class="section-paragraph">
                                        <h4> 5) Border Detection</h4>
                                        <h5>Scenarios:  </h5>
                                        <p> a) When the tetris first appear on board, it needs to be within the border to be able to fall from the board; </p>
                                        <p> b) When the board manipulates the tetris to move in the air, it must be moved within the border; </p>
                                        <p> c) When the board manipulates the tetris to do rotation, it needs to be always within the border. </p>    

                                    </p>
                                    <h5>Implementation: </h5>
                                    <p>
                                        We always tentatively assume the tetris could do the supposed movement(including rotation and translation) and then detect whether any part of tetris is laid beyond the border. If so, the tetris would maintain its last movement. Especially, when the tetris is rotating beyond the border during falling, we would update its self-rotation matrix in terms of the board coordinate and maintain its self-rotation matrix in terms of the bottom coordinate. 
                                    </p>
                                    <br/>
                                    <p>

                                    </p>
                                </div>

                            </div>
                        </div>
                    </section>                            <hr/>   
                    <div class="container" id="thumbNails">

                        <div class="row">

                            <div class="col-lg-12">
                                <h1 class="page-header">Thumbnail Gallery</h1>
                            </div>

                            <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                                <a class="thumbnail" href="#">
                                    <img class="img-responsive" src="image/rotation1.png" alt="">
                                </a>
                                <h4>Rotation1</h4>
                            </div>
                            <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                                <a class="thumbnail" href="#">
                                    <img class="img-responsive" src="image/rotation2.png" alt="">
                                </a>
                                <h4>Rotation2</h4>
                            </div>
                            <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                                <a class="thumbnail" href="#">
                                    <img class="img-responsive" src="image/move1.png" alt="">
                                </a>
                                <h4>Move Left</h4>
                            </div>
                            <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                                <a class="thumbnail" href="#">
                                    <img class="img-responsive" src="image/move2.png" alt="">
                                </a>
                                <h4>Move Right</h4>
                            </div>
                            <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                                <a class="thumbnail" href="#">
                                    <img class="img-responsive" src="image/movefront.png" alt="">
                                </a>
                                <h4>Move Front</h4>
                            </div>
                            <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                                <a class="thumbnail" href="#">
                                    <img class="img-responsive" src="image/moveback.png" alt="">
                                </a>

                                <h4>Move Back</h4>
                            </div>
                        </div>
                        
                            <hr/>                    
                            
                            <div class="container">

                        <div class="row">

                            <div class="col-lg-12">
                                <h1 class="page-header">Demo</h1>
                            <p>Click <a href="https://www.youtube.com/watch?v=Icbgk8CSI10">here</a> to enjoy your first AR tetris experience!</p>
                            </div>
                        </div>
                    </div>
                </section>

                        
                        <!--<div class="media">
                <!--          <div class="media-left">-->
                <!--            <a href="#">-->
                <!--              <img class="media-object" src="https://www.youtube.com/watch?v=Icbgk8CSI10" alt="...">-->
                <!--          </a>-->
                <!--      </div>-->
                <!--      <div class="media-body">-->
                <!--        <h4 class="media-heading">Media heading</h4>-->
                <!--        ...-->
                <!--    </div>-->
                <!--</div>-->-->

                <!-- Footer -->
                <footer>
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <p>Copyright &copy; 3D Tetris Team 2015</p>
                            </div>
                        </div>
                        <!-- /.row -->
                    </div>
                    <!-- /.container -->
                </footer>

                <!-- jQuery -->
                <script src="js/jquery.js"></script>

                <!-- Bootstrap Core JavaScript -->
                <script src="js/bootstrap.min.js"></script>

            </body>

            </html>
